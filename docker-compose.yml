# docker-compose.yml
services:
  dev:
    build:
      context: .
      dockerfile: docker/dev.Dockerfile
      args:
        UID: ${UID}
        GID: ${GID}
    user: "${UID}:${GID}"
    environment:
      HOME: /home/dev
      NOTES_ROOT: /notes_repo/notes
      GIT_AUTHOR_NAME: mirai-dev
      GIT_AUTHOR_EMAIL: mirai-dev@example.local
      GIT_COMMITTER_NAME: mirai-dev
      GIT_COMMITTER_EMAIL: mirai-dev@example.local
    volumes:
      - .:/workspace:cached
      - ../notes_repo:/notes_repo:cached
      - dev-home:/home/dev
      - bundler-cache:/home/dev/.bundle
    working_dir: /workspace
    command: bundle exec puma -b tcp://0.0.0.0:4567 config.ru
    tty: true
    stdin_open: true
    ports:
      - "4567:4567"
volumes:
  dev-home:
  bundler-cache:
